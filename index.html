<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>GIS Web App</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.32/esri/themes/light/main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/shepherd.js@11.2.0/dist/css/shepherd.css">
  <script src="https://cdn.jsdelivr.net/npm/shepherd.js@11.2.0/dist/js/shepherd.min.js"></script>

  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css?family=Gruppo|Orbitron&display=swap" rel="stylesheet">
  <script src="https://js.arcgis.com/4.32/"></script>
</head>

<body>
  <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-animation">
        <div class="loading-ring"></div>
        <i class="fas fa-globe-americas loading-icon"></i>
      </div>
      <p class="loading-text">Initializing Map...</p>
    </div>
  </div>

  <!-- Main Map Container -->
  <div id="displayMap"></div>

  <!-- Top Bar -->
  <div class="top-bar">
    <div class="brand">
      <i class="fas fa-map-marked-alt"></i>
      <!-- <span id="titleApp">GIS Explorer</span> -->
      <span id="titleApp">حدائق حائل</span>
    </div>

    <!-- Search Container -->
    <div class="search-container">
      <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" placeholder="Search addresses..." autocomplete="off" />
        <button id="clearSearch" class="clear-search" style="display: none;">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="searchSuggestions" class="search-suggestions"></div>
    </div>
  </div>


<!-- Top Bar ends here -->

<!-- Add this new section here -->
<div class="map-tabs-container">
  <div class="tab-wrapper">

        <button class="tab-button" data-tab="assets">
      <span class="tab-text">الأصول</span>
      <div class="tab-indicator disabled">
        <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
      </div>
    </button>

        <button class="tab-button" data-tab="projects">
      <span class="tab-text">المشروعات</span>
      <div class="tab-indicator disabled">
        <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
      </div>
    </button>
    

    <button class="tab-button active" data-tab="gardens">
      <span class="tab-text">الحدائق</span>
      <div class="tab-indicator">
        <svg class="checkmark" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <path d="M20 6L9 17l-5-5"/>
        </svg>
      </div>
    </button>
    

    

  </div>
</div>

<!-- Tab Content Modal -->
<div id="tabBackdrop" class="tab-backdrop hidden">
  <div class="tab-content-card">
    <!-- Content will be dynamically inserted here -->
  </div>
</div>

<!-- Main Toolbar (Desktop) -->

  <!-- Main Toolbar (Desktop) -->
  <div class="main-toolbar">
    <div class="toolbar-group">
      <button class="toolbar-btn" id="uploadBtn" title="Upload Files">
        <i class="fas fa-cloud-upload-alt"></i>
        <span class="toolbar-label">Upload</span>
      </button>
      <button class="toolbar-btn" id="layersBtn" title="Layers">
        <i class="fas fa-layer-group"></i>
        <span class="toolbar-label">Layers</span>
      </button>
      <button class="toolbar-btn" id="basemapBtn" title="Basemap">
        <i class="fas fa-map"></i>
        <span class="toolbar-label">Basemap</span>
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <div class="toolbar-group">
      <!-- <button class="toolbar-btn" id="measureBtn" title="Measure">
        <i class="fas fa-ruler-combined"></i>
        <span class="toolbar-label">Measure</span>
      </button> -->
      <button class="toolbar-btn" id="drawBtn" title="Draw">
        <i class="fas fa-pencil-alt"></i>
        <span class="toolbar-label">Draw</span>
      </button>
      <button class="toolbar-btn" id="locateBtn" title="My Location">
        <i class="fas fa-crosshairs"></i>
        <span class="toolbar-label">Locate</span>
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <div class="toolbar-group">
      <button class="toolbar-btn" id="analysisBtn" title="Analysis">
        <i class="fas fa-chart-area"></i>
        <span class="toolbar-label">Analysis</span>
      </button>
      <button class="toolbar-btn" id="visualizeBtn" title="Visualization">
        <i class="fas fa-fire"></i>
        <span class="toolbar-label">Visualize</span>
      </button>

      <button class="toolbar-btn" id="classificationBtn" title="Classification">
        <i class="fas fa-palette"></i>
        <span class="toolbar-label">Classify</span>
      </button>

      <button class="toolbar-btn" id="tableBtn" onclick="toggleAttributeTable()" title="Attribute Table">
        <i class="fas fa-table"></i>
        <span class="toolbar-label">Table</span>
      </button>
    </div>

    <div class="toolbar-separator"></div>

    <div class="toolbar-group">
      <button class="toolbar-btn" onclick="toggleWidget('legend')" title="Legend">
        <i class="fas fa-list"></i>
        <span class="toolbar-label">Legend</span>
      </button>
      <button class="toolbar-btn" onclick="toggleWidget('bookmarks')" title="Bookmarks">
        <i class="fas fa-bookmark"></i>
        <span class="toolbar-label">Bookmarks</span>
      </button>
      <button class="toolbar-btn" onclick="toggleWidget('print')" title="Print">
        <i class="fas fa-print"></i>
        <span class="toolbar-label">Print</span>
      </button>
    </div>
  </div>

  <!-- Mobile Toolbar Button -->
  <button class="mobile-toolbar-toggle" id="mobileToolbarToggle">
    <i class="fas fa-tools"></i>
  </button>

  <!-- Mobile Toolbar Menu -->
  <div class="mobile-toolbar-menu" id="mobileToolbarMenu">
    <div class="mobile-menu-header">
      <h3>Tools</h3>
      <button class="mobile-menu-close" id="mobileMenuClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="mobile-menu-grid">
      <button class="mobile-menu-item" data-action="upload">
        <i class="fas fa-cloud-upload-alt"></i>
        <span>Upload</span>
      </button>
      <button class="mobile-menu-item" data-action="layers">
        <i class="fas fa-layer-group"></i>
        <span>Layers</span>
      </button>
      <button class="mobile-menu-item" data-action="basemap">
        <i class="fas fa-map"></i>
        <span>Basemap</span>
      </button>
      <!-- <button class="mobile-menu-item" data-action="measure">
        <i class="fas fa-ruler-combined"></i>
        <span>Measure</span>
      </button> -->
      <button class="mobile-menu-item" data-action="draw">
        <i class="fas fa-pencil-alt"></i>
        <span>Draw</span>
      </button>
      <button class="mobile-menu-item" data-action="locate">
        <i class="fas fa-crosshairs"></i>
        <span>Locate</span>
      </button>
      <button class="mobile-menu-item" data-action="analysis">
        <i class="fas fa-chart-area"></i>
        <span>Analysis</span>
      </button>
      <button class="mobile-menu-item" data-action="visualize">
        <i class="fas fa-fire"></i>
        <span>Visualize</span>
      </button>

      <button class="mobile-menu-item" data-action="classification">
        <i class="fas fa-palette"></i>
        <span>Classify</span>
      </button>


      <button class="mobile-menu-item" onclick="toggleAttributeTable()">
        <i class="fas fa-table"></i>
        <span>Table</span>
      </button>
      <button class="mobile-menu-item" onclick="toggleWidget('legend')">
        <i class="fas fa-list"></i>
        <span>Legend</span>
      </button>
      <button class="mobile-menu-item" onclick="toggleWidget('bookmarks')">
        <i class="fas fa-bookmark"></i>
        <span>Bookmarks</span>
      </button>
      <button class="mobile-menu-item" onclick="toggleWidget('print')">
        <i class="fas fa-print"></i>
        <span>Print</span>
      </button>
    </div>
  </div>

  <!-- Side Panel Container -->
  <div class="side-panel" id="sidePanel">
    <div class="side-panel-header">
      <h2 id="sidePanelTitle">Panel</h2>
      <button class="side-panel-close" id="sidePanelClose">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="side-panel-content" id="sidePanelContent">
      <!-- Dynamic content will be loaded here -->
    </div>
  </div>

  <!-- Quick Actions (Bottom Right) -->
  <div class="quick-actions">

    <button class="quick-action-btn" onclick="manuallyStartTour()" title="Feature Tour">
      <i class="fas fa-route"></i>
    </button>

    <!-- Add zoom controls first -->
    <button class="quick-action-btn" onclick="zoomIn()" title="Zoom In">
      <i class="fas fa-plus"></i>
    </button>
    <button class="quick-action-btn" onclick="zoomOut()" title="Zoom Out">
      <i class="fas fa-minus"></i>
    </button>


    <!-- Add after the zoom buttons -->
    <button class="quick-action-btn" onclick="startAppTour()" title="Take a Tour">
      <i class="fas fa-question-circle"></i>
    </button>


    <button class="quick-action-btn" onclick="toggleWidget('home')" title="Home">
      <i class="fas fa-home"></i>
    </button>
    <button class="quick-action-btn" onclick="toggleWidget('fullscreen')" title="Fullscreen">
      <i class="fas fa-expand"></i>
    </button>
    <button class="quick-action-btn" id="clearBtn" title="Clear All">
      <i class="fas fa-trash"></i>
    </button>
    
  </div>

  <!-- Coordinates Display -->
  <!-- Replace the existing coordinates display with this -->
  <div class="coordinates-display">
    <i class="fas fa-location-dot"></i>
    <span id="coordDisplay">Move cursor over map</span>
    <button id="copyCoords" class="copy-coords-btn" title="Copy coordinates">
      <i class="fas fa-copy"></i>
    </button>
  </div>

  <!-- Country Info Display -->
  <div id="countryInfo" class="country-info-display hidden">
    <h3 id="countryName"></h3>
    <div id="countryDetails"></div>
  </div>



  <!-- Panel Templates (Hidden) -->
  <div style="display: none;">
    <!-- Upload Panel Template -->
    <div id="uploadPanelTemplate">
      <div class="panel-section">
        <div id="dropZone" class="drop-zone">
          <div class="drop-zone-icon">
            <i class="fas fa-cloud-upload-alt"></i>
          </div>
          <h3>Drop files here</h3>
          <p>or click to browse</p>
          <div class="supported-formats">
            <span class="format-badge">CSV</span>
            <span class="format-badge">GeoJSON</span>
          </div>
          <input type="file" id="fileInput" accept=".csv,.geojson,.json" hidden multiple />
        </div>
      </div>
    </div>

    <!-- Layers Panel Template -->
    <div id="layersPanelTemplate">
      <div class="panel-section">
        <div id="layerList" class="layer-list">
          <div class="empty-state">
            <i class="fas fa-layer-group"></i>
            <p>No layers loaded</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Basemap Panel Template -->
    <div id="basemapPanelTemplate">
      <div class="panel-section">
        <div class="basemap-gallery">
          <div class="basemap-item" data-basemap="topo">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/topo.jpg" alt="Topo">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Topographic</span>
          </div>
          <div class="basemap-item" data-basemap="streets">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/streets.jpg" alt="Streets">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Streets</span>
          </div>
          <div class="basemap-item" data-basemap="satellite">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/satellite.jpg" alt="Satellite">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Satellite</span>
          </div>
          <div class="basemap-item active" data-basemap="hybrid">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/hybrid.jpg" alt="Hybrid">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Hybrid</span>
          </div>
          <div class="basemap-item" data-basemap="dark-gray">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/dark-gray.jpg" alt="Dark">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Dark Gray</span>
          </div>
          <div class="basemap-item" data-basemap="gray">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/gray.jpg" alt="Gray">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Light Gray</span>
          </div>
          <div class="basemap-item" data-basemap="oceans">
            <div class="basemap-thumbnail">
              <img src="https://js.arcgis.com/4.32/esri/images/basemap/oceans.jpg" alt="Oceans">
              <div class="basemap-check"><i class="fas fa-check"></i></div>
            </div>
            <span>Oceans</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Drawing Panel Template -->
    <div id="drawingPanelTemplate">
      <div class="panel-section">
        <div class="drawing-tools">
          <button class="draw-tool-btn" data-tool="point" title="Draw Point">
            <i class="fas fa-map-marker-alt"></i>
            <span>Point</span>
          </button>
          <button class="draw-tool-btn" data-tool="polyline" title="Draw Line">
            <i class="fas fa-route"></i>
            <span>Line</span>
          </button>
          <button class="draw-tool-btn" data-tool="polygon" title="Draw Polygon">
            <i class="fas fa-draw-polygon"></i>
            <span>Polygon</span>
          </button>
          <button class="draw-tool-btn" data-tool="rectangle" title="Draw Rectangle">
            <i class="fas fa-vector-square"></i>
            <span>Rectangle</span>
          </button>
          <button class="draw-tool-btn" data-tool="circle" title="Draw Circle">
            <i class="fas fa-circle"></i>
            <span>Circle</span>
          </button>
        </div>

        <div class="drawing-settings">
          <div class="setting-row">
            <label><i class="fas fa-palette"></i> Color</label>
            <input type="color" id="drawColor" value="#2196F3" class="color-picker">
          </div>
          <div class="setting-row">
            <label><i class="fas fa-adjust"></i> Opacity</label>
            <div class="slider-container">
              <input type="range" id="drawOpacity" min="0" max="100" value="70" class="opacity-slider">
              <span class="slider-value">70%</span>
            </div>
          </div>
          <button id="clearDrawings" class="action-btn danger">
            <i class="fas fa-eraser"></i> Clear All Drawings
          </button>
        </div>
      </div>
    </div>

    <!-- Analysis Panel Template -->
    <div id="analysisPanelTemplate">
      <div class="panel-section">
        <div class="analysis-grid">
          <button class="analysis-card" onclick="startBufferAnalysis()">
            <div class="analysis-icon">
              <i class="fas fa-circle-notch"></i>
            </div>
            <h4>Buffer</h4>
            <p>Create buffer zones around features</p>
          </button>
          <button class="analysis-card" onclick="startIntersectAnalysis()">
            <div class="analysis-icon">
              <i class="fas fa-object-group"></i>
            </div>
            <h4>Intersect</h4>
            <p>Find overlapping areas</p>
          </button>
          <button class="analysis-card" onclick="startDistanceAnalysis()">
            <div class="analysis-icon">
              <i class="fas fa-ruler-horizontal"></i>
            </div>
            <h4>Distance</h4>
            <p>Measure between features</p>
          </button>
          <button class="analysis-card" onclick="startAreaAnalysis()">
            <div class="analysis-icon">
              <i class="fas fa-vector-square"></i>
            </div>
            <h4>Calculate Area</h4>
            <p>Compute polygon areas</p>
          </button>
        </div>
      </div>
    </div>

    <!-- Visualization Panel Template -->
    <div id="visualizationPanelTemplate">
      <div class="panel-section">
        <div class="viz-option">
          <div class="viz-header">
            <h4><i class="fas fa-fire"></i> Heatmap</h4>
            <label class="toggle-switch">
              <input type="checkbox" id="heatmapToggle" onchange="toggleHeatmap()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="viz-controls" id="heatmapControls" style="display: none;">
            <select id="heatmapLayerSelect" class="select-input">
              <option value="">Select point layer...</option>
            </select>
            <button class="settings-btn" onclick="showHeatmapSettings()" id="heatmapSettingsBtn">
              <i class="fas fa-cog"></i> Settings
            </button>
          </div>
        </div>

        <div class="viz-option">
          <div class="viz-header">
            <h4><i class="fas fa-clock"></i> Time Animation</h4>
            <label class="toggle-switch">
              <input type="checkbox" id="timeToggle" onchange="toggleTimeControls()">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="viz-controls" id="timeControlsPanel" style="display: none;">
            <select id="timeLayerSelect" class="select-input">
              <option value="">Select time-enabled layer...</option>
            </select>
            <div class="time-field-select" style="display: none;">
              <label>Date Field:</label>
              <select id="timeFieldSelect" class="select-input">
                <option value="">Select date field...</option>
              </select>
            </div>
            <div class="time-slider-container" style="display: none;">
              <div id="timeSliderDiv"></div>
              <div class="time-animation-controls">
                <button class="time-btn" onclick="playTimeAnimation()">
                  <i class="fas fa-play" id="playIcon"></i>
                </button>
                <button class="time-btn" onclick="stopTimeAnimation()">
                  <i class="fas fa-stop"></i>
                </button>
                <select id="animationSpeed" class="speed-select">
                  <option value="0.5">0.5x</option>
                  <option value="1" selected>1x</option>
                  <option value="2">2x</option>
                  <option value="5">5x</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Classification Panel Template -->
    <div id="classificationPanelTemplate">
      <div class="panel-section">
        <div class="classification-container">
          <div class="form-group">
            <label class="form-label">Select Layer</label>
            <select id="classifyLayerSelect" class="select-input">
              <option value="">Choose a layer...</option>
            </select>
          </div>

          <div class="form-group" id="classifyFieldSection" style="display: none;">
            <label class="form-label">Select Field</label>
            <select id="classifyFieldSelect" class="select-input">
              <option value="">Choose a field...</option>
            </select>
          </div>

          <div id="fieldStatistics" class="field-stats" style="display: none;">
            <div class="stats-content"></div>
          </div>

          <div class="classification-actions" style="display: none;">
            <button class="action-btn primary" onclick="applyClassification()">
              <i class="fas fa-paint-brush"></i> Apply Classification
            </button>
            <button class="action-btn secondary" onclick="resetClassification()">
              <i class="fas fa-undo"></i> Reset
            </button>
          </div>
        </div>
      </div>
    </div>


  </div>

  <!-- Widget Containers -->
  <div class="widget-container" id="widgetContainer">
    <!-- Legend Widget -->
    <div id="legendWidget" class="custom-widget hidden" data-widget-name="Legend">
      <div class="widget-header">
        <h3><i class="fas fa-list"></i> Legend</h3>
        <button class="widget-close" onclick="toggleWidget('legend')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="legendContent" class="widget-content"></div>
    </div>

    <!-- Bookmarks Widget -->
    <div id="bookmarksWidget" class="custom-widget hidden" data-widget-name="Bookmarks">
      <div class="widget-header">
        <h3><i class="fas fa-bookmark"></i> Bookmarks</h3>
        <button class="widget-close" onclick="toggleWidget('bookmarks')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="widget-content">
        <button id="addBookmark" class="action-btn primary">
          <i class="fas fa-plus"></i> Add Current View
        </button>
        <div id="bookmarksList" class="bookmarks-list"></div>
      </div>
    </div>

    <!-- Print Widget -->
    <div id="printWidget" class="custom-widget hidden" data-widget-name="Print">
      <div class="widget-header">
        <h3><i class="fas fa-print"></i> Print Map</h3>
        <button class="widget-close" onclick="toggleWidget('print')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="printContent" class="widget-content"></div>
    </div>

    <!-- Measurement Results Widget -->
    <div id="measurementResults" class="custom-widget hidden" data-widget-name="Measurements">
      <div class="widget-header">
        <h3><i class="fas fa-ruler-combined"></i> Measurement Results</h3>
        <button class="widget-close" onclick="closeMeasurementResults()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="measurementContent" class="widget-content"></div>
    </div>

    <!-- Distance Panel -->
    <div id="distancePanel" class="custom-widget hidden" data-widget-name="Distance">
      <div class="widget-header">
        <h3><i class="fas fa-ruler-horizontal"></i> Distance Measurement</h3>
        <button class="widget-close" onclick="closeDistancePanel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="widget-content">
        <p class="help-text">Click on two features to measure distance</p>
        <div id="distanceResult" class="analysis-result"></div>
        <button class="action-btn secondary" onclick="clearDistanceMeasurement()">
          Clear Measurement
        </button>
      </div>
    </div>
  </div>

  <!-- Custom Popup -->
  <div id="customPopup" class="custom-popup hidden">
    <div class="popup-header">
      <h3 id="popupTitle">Feature Information</h3>
      <button class="popup-close" onclick="closeCustomPopup()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="popupContent" class="popup-content"></div>
  </div>

  <!-- Attribute Table Widget -->
  <div id="attributeTableWidget" class="attribute-table-widget hidden">
    <div class="attribute-table-header">
      <div class="table-title">
        <i class="fas fa-table"></i>
        <h3>Attribute Table</h3>
      </div>
      <div class="table-controls">
        <select id="tableLayerSelect" class="select-input">
          <option value="">Select a layer...</option>
        </select>
        <div class="search-box table-search">
          <i class="fas fa-search"></i>
          <input type="text" id="tableSearchInput" placeholder="Search..." />
        </div>
        <button class="icon-btn" onclick="refreshTable()" title="Refresh">
          <i class="fas fa-sync"></i>
        </button>
        <button class="icon-btn" onclick="showExportOptions()" title="Export">
          <i class="fas fa-download"></i>
        </button>
        <button class="icon-btn close-table-btn" onclick="toggleAttributeTable()" title="Close">
          <i class="fas fa-times"></i> <span style="margin-left: 4px; font-size: 12px;">Close</span>
        </button>
      </div>
    </div>
    <div class="attribute-table-content">
      <div id="tableContainer"></div>
      <div class="table-pagination">
        <div class="pagination-info">
          <span id="tablePaginationInfo">0 records</span>
        </div>
        <div class="pagination-controls">
          <button id="tablePrevBtn" onclick="previousPage()" class="pagination-btn" disabled>
            <i class="fas fa-chevron-left"></i>
          </button>
          <span id="tablePageInfo" class="page-info">Page 1 of 1</span>
          <button id="tableNextBtn" onclick="nextPage()" class="pagination-btn" disabled>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <!-- Buffer Modal -->
  <div id="bufferModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeBufferModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-circle-notch"></i> Buffer Analysis</h3>
        <button class="modal-close" onclick="closeBufferModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Feature Source</label>
          <div class="button-group">
            <button class="button-group-item active" onclick="setBufferSource('layer')">
              <i class="fas fa-layer-group"></i> From Layer
            </button>
            <button class="button-group-item" onclick="setBufferSource('draw')">
              <i class="fas fa-pencil-alt"></i> Draw on Map
            </button>
          </div>
        </div>

        <div id="bufferLayerSection" class="form-group">
          <label class="form-label">Select Layer</label>
          <select id="bufferLayerSelect" class="select-input">
            <option value="">Choose a layer...</option>
          </select>
        </div>

        <div id="bufferDrawSection" style="display: none;">
          <div class="draw-tools-grid">
            <button class="draw-option-btn" onclick="startBufferDrawing('point')">
              <i class="fas fa-map-marker-alt"></i>
              <span>Point</span>
            </button>
            <button class="draw-option-btn" onclick="startBufferDrawing('polyline')">
              <i class="fas fa-route"></i>
              <span>Line</span>
            </button>
            <button class="draw-option-btn" onclick="startBufferDrawing('polygon')">
              <i class="fas fa-draw-polygon"></i>
              <span>Polygon</span>
            </button>
          </div>
          <p class="help-text" id="bufferDrawHelp" style="display: none;">
            <i class="fas fa-info-circle"></i> Click on the map to draw features
          </p>
        </div>

        <div class="form-row">
          <div class="form-group flex-1">
            <label class="form-label">Buffer Distance</label>
            <input type="number" id="bufferDistance" value="100" class="input-field" min="0">
          </div>
          <div class="form-group flex-1">
            <label class="form-label">Unit</label>
            <select id="bufferUnit" class="select-input">
              <option value="meters">Meters</option>
              <option value="kilometers">Kilometers</option>
              <option value="feet">Feet</option>
              <option value="miles">Miles</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="bufferUnion" checked>
            <span>Union overlapping buffers</span>
          </label>
        </div>

        <button class="action-btn primary full-width" onclick="executeBuffer()">
          <i class="fas fa-play"></i> Execute Analysis
        </button>
      </div>
    </div>
  </div>

  <!-- Intersection Modal -->
  <div id="intersectModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeIntersectModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3><i class="fas fa-object-group"></i> Intersection Analysis</h3>
        <button class="modal-close" onclick="closeIntersectModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="feature-section">
          <h4 class="section-title">First Feature Set</h4>
          <div class="form-group">
            <div class="button-group">
              <button class="button-group-item active" onclick="window.setIntersectSource(1, 'layer')">
                <i class="fas fa-layer-group"></i> From Layer
              </button>
              <button class="button-group-item" onclick="window.setIntersectSource(1, 'draw')">
                <i class="fas fa-pencil-alt"></i> Draw Polygon
              </button>
            </div>
          </div>
          <div id="intersectLayer1Section" class="form-group">
            <select id="intersectLayer1Select" class="select-input">
              <option value="">Select first layer...</option>
            </select>
          </div>
          <div id="intersectDraw1Section" style="display: none;">
            <button class="action-btn secondary" onclick="startIntersectDrawing(1)">
              <i class="fas fa-draw-polygon"></i> Start Drawing
            </button>
          </div>
        </div>

        <div class="feature-section">
          <h4 class="section-title">Second Feature Set</h4>
          <div class="form-group">
            <div class="button-group">
              <button class="button-group-item active" onclick="window.setIntersectSource(2, 'layer')">
                <i class="fas fa-layer-group"></i> From Layer
              </button>
              <button class="button-group-item" onclick="window.setIntersectSource(2, 'draw')">
                <i class="fas fa-pencil-alt"></i> Draw Polygon
              </button>
            </div>
          </div>
          <div id="intersectLayer2Section" class="form-group">
            <select id="intersectLayer2Select" class="select-input">
              <option value="">Select second layer...</option>
            </select>
          </div>
          <div id="intersectDraw2Section" style="display: none;">
            <button class="action-btn secondary" onclick="startIntersectDrawing(2)">
              <i class="fas fa-draw-polygon"></i> Start Drawing
            </button>
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="keepNonIntersecting" checked>
            <span>Show non-intersecting areas</span>
          </label>
        </div>

        <button class="action-btn primary full-width" onclick="executeIntersection()">
          <i class="fas fa-play"></i> Execute Analysis
        </button>
      </div>
    </div>
  </div>

  <!-- Heatmap Settings Modal -->
  <div id="heatmapModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeHeatmapSettings()"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3><i class="fas fa-fire"></i> Heatmap Settings</h3>
        <button class="modal-close" onclick="closeHeatmapSettings()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Weight Field</label>
          <select id="heatmapField" class="select-input">
            <option value="">None (Equal weight)</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">
            Radius: <span id="radiusValue" class="value-label">10</span>px
          </label>
          <input type="range" id="heatmapRadius" min="5" max="50" value="10" class="slider-input">
        </div>

        <div class="form-group">
          <label class="form-label">
            Max Intensity: <span id="intensityValue" class="value-label">100</span>
          </label>
          <input type="range" id="heatmapIntensity" min="10" max="200" value="100" class="slider-input">
        </div>

        <div class="form-group">
          <label class="form-label">
            Blur Radius: <span id="blurValue" class="value-label">15</span>px
          </label>
          <input type="range" id="heatmapBlur" min="5" max="30" value="15" class="slider-input">
        </div>

        <div class="form-group">
          <label class="form-label">
            Min Density: <span id="minDensityValue" class="value-label">0</span>
          </label>
          <input type="range" id="heatmapMinDensity" min="0" max="10" value="0" step="0.1" class="slider-input">
        </div>

        <div class="form-group">
          <label class="form-label">
            Max Density: <span id="maxDensityValue" class="value-label">10</span>
          </label>
          <input type="range" id="heatmapMaxDensity" min="1" max="50" value="10" step="0.5" class="slider-input">
        </div>

        <div class="form-group">
          <label class="form-label">Color Scheme</label>
          <div class="color-schemes">
            <button class="color-scheme active" data-scheme="default" onclick="selectColorScheme('default')">
              <div class="color-gradient gradient-default"></div>
              <span>Heat</span>
            </button>
            <button class="color-scheme" data-scheme="blue" onclick="selectColorScheme('blue')">
              <div class="color-gradient gradient-blue"></div>
              <span>Cool</span>
            </button>
            <button class="color-scheme" data-scheme="green" onclick="selectColorScheme('green')">
              <div class="color-gradient gradient-green"></div>
              <span>Nature</span>
            </button>
            <button class="color-scheme" data-scheme="purple" onclick="selectColorScheme('purple')">
              <div class="color-gradient gradient-purple"></div>
              <span>Purple</span>
            </button>
          </div>
        </div>

        <button class="action-btn primary full-width" onclick="applyHeatmapSettings()">
          <i class="fas fa-check"></i> Apply Settings
        </button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div id="exportModal" class="modal hidden">
    <div class="modal-overlay" onclick="closeExportModal()"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h3><i class="fas fa-download"></i> Export Data</h3>
        <button class="modal-close" onclick="closeExportModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Select Layer</label>
          <select id="exportLayerSelect" class="select-input">
            <option value="">Choose a layer...</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Export Format</label>
          <div class="export-formats">
            <button class="export-format-btn" onclick="exportData('csv')">
              <i class="fas fa-file-csv"></i>
              <span>CSV</span>
            </button>
            <button class="export-format-btn" onclick="exportData('geojson')">
              <i class="fas fa-map-marked"></i>
              <span>GeoJSON</span>
            </button>
            <button class="export-format-btn" onclick="exportData('excel')">
              <i class="fas fa-file-excel"></i>
              <span>Excel</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="script.js"></script>
  <!-- <script type="module" src="foreignLogic.js"></script> -->
</body>

</html>